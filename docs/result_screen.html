<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>ê²°ê³¼ í™•ì¸ í™”ë©´ - ì½©ì½©íŒ¥íŒ¥</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
        width: 100%;
        overflow: hidden;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background-color: #ffffff;
      }

      body {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      .screen-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
        width: 100%;
        max-width: 480px;
        background-color: #ffffff;
        box-sizing: border-box;
        padding-bottom: env(safe-area-inset-bottom); /* ë…¸ì¹˜ ë””ìì¸ ëŒ€ì‘ */
        position: relative;
      }

      /* í—¤ë” ì˜ì—­ */
      .header {
        padding: 20px 16px;
        text-align: center;
        border-bottom: 1px solid #eeeeee;
      }

      .header-title {
        font-size: 18px;
        font-weight: 600;
        color: #333333;
      }

      .game-mode-info {
        font-size: 14px;
        color: #666666;
        margin-top: 4px;
      }

      /* ê²°ê³¼ ì˜ì—­ */
      .result-section {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        position: relative;
        overflow: hidden;
      }

      /* ê²°ê³¼ ë©”ì‹œì§€ */
      .result-announcement {
        text-align: center;
        margin-bottom: 30px;
      }

      .result-title {
        font-size: 24px;
        font-weight: 600;
        color: #333333;
        margin-bottom: 8px;
      }

      .result-subtitle {
        font-size: 16px;
        color: #666666;
      }

      /* ìºë¦­í„° í‘œì‹œ ì˜ì—­ */
      .result-characters {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 20px 0 40px 0;
        flex-wrap: wrap;
      }

      .character-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 0 15px;
        animation: appearWithBounce 0.6s ease forwards;
      }

      .character-emoji {
        font-size: 5em;
        margin-bottom: 10px;
        position: relative;
      }

      .winner .character-emoji::after {
        content: "ğŸ†";
        position: absolute;
        top: -15px;
        right: -15px;
        font-size: 0.4em;
      }

      .loser .character-emoji::after {
        content: "ğŸ˜“";
        position: absolute;
        top: -15px;
        right: -15px;
        font-size: 0.4em;
      }

      .character-info {
        text-align: center;
      }

      .character-name {
        font-size: 16px;
        font-weight: 500;
        margin-bottom: 2px;
      }

      .character-score {
        font-size: 18px;
        font-weight: 600;
        color: #007aff;
      }

      /* ì ìˆ˜ ìˆœìœ„í‘œ ì˜ì—­ */
      .score-board {
        width: 100%;
        max-width: 340px;
        background-color: #f8f9fa;
        border-radius: 10px;
        border: 1px solid #e9ecef;
        padding: 16px;
        margin-bottom: 20px;
      }

      .score-board-title {
        font-size: 15px;
        font-weight: 600;
        color: #333333;
        margin-bottom: 10px;
        text-align: center;
      }

      .score-list {
        width: 100%;
      }

      .score-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #e9ecef;
      }

      .score-item:last-child {
        border-bottom: none;
      }

      .score-rank {
        width: 30px;
        font-size: 14px;
        font-weight: 500;
        color: #666666;
        text-align: center;
      }

      .score-player {
        flex: 1;
        display: flex;
        align-items: center;
      }

      .score-emoji {
        font-size: 1.4em;
        margin-right: 8px;
      }

      .score-name {
        font-size: 14px;
        color: #333333;
      }

      .score-value {
        font-size: 16px;
        font-weight: 600;
        color: #007aff;
        min-width: 50px;
        text-align: right;
      }

      .score-item.highlighted {
        background-color: #f0f8ff;
        border-radius: 6px;
        padding: 8px 10px;
        margin: 2px 0;
      }

      /* ì¥ì‹ íš¨ê³¼ */
      .confetti {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 10;
        opacity: 0.7;
      }

      /* í•˜ë‹¨ ë²„íŠ¼ ì˜ì—­ */
      .bottom-section {
        padding: 16px;
        background-color: #ffffff;
        border-top: 1px solid #eeeeee;
      }

      .button-group {
        display: flex;
        gap: 10px;
      }

      button {
        flex: 1;
        padding: 14px 0;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.2s ease, transform 0.1s ease;
      }

      button:active {
        transform: scale(0.98);
      }

      .primary-button {
        background-color: #007aff;
        color: white;
      }

      .secondary-button {
        background-color: #f2f2f7;
        color: #333333;
      }

      /* ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
      @keyframes appearWithBounce {
        0% {
          transform: scale(0);
          opacity: 0;
        }
        60% {
          transform: scale(1.1);
          opacity: 1;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      .highlight-pulse {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      .animated-emoji {
        display: inline-block;
        animation: bounce 1s infinite alternate;
      }

      @keyframes bounce {
        from {
          transform: translateY(0);
        }
        to {
          transform: translateY(-10px);
        }
      }
    </style>
  </head>
  <body>
    <div class="screen-container">
      <!-- í—¤ë” ì˜ì—­ -->
      <div class="header">
        <h1 class="header-title">ê²Œì„ ê²°ê³¼</h1>
        <div class="game-mode-info" id="game-mode-text">íŒ¨ì ê²°ì • ëª¨ë“œ</div>
      </div>

      <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
      <div class="result-section" id="result-section">
        <!-- ê²°ê³¼ ë°œí‘œ -->
        <div class="result-announcement">
          <h2 class="result-title">ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
          <p class="result-subtitle" id="result-message">
            ë‹¤ìŒ í”Œë ˆì´ì–´ê°€ ê¼´ë“±ì…ë‹ˆë‹¤
          </p>
        </div>

        <!-- ìš°ìŠ¹/ê¼´ë“± ìºë¦­í„° í‘œì‹œ -->
        <div class="result-characters" id="result-characters">
          <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
        </div>

        <!-- ì ìˆ˜ ìˆœìœ„í‘œ -->
        <div class="score-board">
          <div class="score-board-title">ì ìˆ˜ ìˆœìœ„</div>
          <div class="score-list" id="score-list">
            <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
          </div>
        </div>
      </div>

      <!-- ë²„íŠ¼ ì˜ì—­ -->
      <div class="bottom-section">
        <div class="button-group">
          <button class="primary-button" id="restart-button">ë‹¤ì‹œí•˜ê¸°</button>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // DOM ìš”ì†Œ
        const gameModeText = document.getElementById("game-mode-text");
        const resultMessage = document.getElementById("result-message");
        const resultCharacters = document.getElementById("result-characters");
        const scoreList = document.getElementById("score-list");
        const restartButton = document.getElementById("restart-button");

        // ê²Œì„ ì„¤ì • (ì‹¤ì œë¡œëŠ” ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ë‚˜ URL íŒŒë¼ë¯¸í„°ì—ì„œ ê°€ì ¸ì™€ì•¼ í•¨)
        const gameSettings = {
          isWinnerMode: false, // false: íŒ¨ì ê²°ì •, true: ìŠ¹ì ê²°ì •
          allowRematch: true, // ì¬ê²½ê¸° ê°€ëŠ¥ ì—¬ë¶€
        };

        // í”Œë ˆì´ì–´ ë°ì´í„° (ì‹¤ì œë¡œëŠ” ì´ì „ í™”ë©´ì—ì„œ ì „ë‹¬ ë°›ì•„ì•¼ í•¨)
        const players = [
          { id: 1, char: "ğŸ¶", name: "ê°•ì•„ì§€", score: 24 },
          { id: 2, char: "ğŸ±", name: "ê³ ì–‘ì´", score: 0 },
          { id: 3, char: "ğŸ¼", name: "íŒë‹¤", score: 18 },
          { id: 4, char: "ğŸ¦Š", name: "ì—¬ìš°", score: 32 },
        ];

        // ê²Œì„ ëª¨ë“œ í…ìŠ¤íŠ¸ ì„¤ì •
        gameModeText.textContent = gameSettings.isWinnerMode
          ? "ìŠ¹ì ê²°ì • ëª¨ë“œ"
          : "íŒ¨ì ê²°ì • ëª¨ë“œ";

        // ê²°ê³¼ ë¶„ì„ ë° í‘œì‹œ
        function displayResults() {
          // 1. ì ìˆ˜ë¡œ ì •ë ¬ëœ í”Œë ˆì´ì–´ ë°°ì—´ ìƒì„±
          let sortedPlayers;
          if (gameSettings.isWinnerMode) {
            // ìŠ¹ì ê²°ì • ëª¨ë“œ - ë†’ì€ ì ìˆ˜ê°€ ìƒìœ„ì— ì˜¤ë„ë¡ ì •ë ¬
            sortedPlayers = [...players].sort((a, b) => b.score - a.score);
            resultMessage.textContent =
              "ì¶•í•˜í•©ë‹ˆë‹¤! ë‹¤ìŒ í”Œë ˆì´ì–´ê°€ ìš°ìŠ¹í–ˆìŠµë‹ˆë‹¤";
          } else {
            // íŒ¨ì ê²°ì • ëª¨ë“œ - ë‚®ì€ ì ìˆ˜ê°€ ìƒìœ„ì— ì˜¤ë„ë¡ ì •ë ¬
            sortedPlayers = [...players].sort((a, b) => a.score - b.score);
            resultMessage.textContent = "ì•„ì‰½ë„¤ìš”! ë‹¤ìŒ í”Œë ˆì´ì–´ê°€ ê¼´ë“±ì…ë‹ˆë‹¤";
          }

          // 2. ê²°ê³¼ ìºë¦­í„° í‘œì‹œ (ìŠ¹ì ë˜ëŠ” íŒ¨ì)
          let resultPlayers;

          // ì¬ê²½ê¸° ê°€ëŠ¥ ì˜µì…˜ì— ë”°ë¼ ë‹¨ë… ë˜ëŠ” ê³µë™ ìš°ìŠ¹/ê¼´ë“± ì²˜ë¦¬
          if (gameSettings.allowRematch) {
            // ì¬ê²½ê¸° ê°€ëŠ¥ - ë‹¨ë… ìš°ìŠ¹/ê¼´ë“±ë§Œ í‘œì‹œ
            resultPlayers = [sortedPlayers[0]];
          } else {
            // ì¬ê²½ê¸° ë¶ˆê°€ëŠ¥ - ë™ì ì ëª¨ë‘ í‘œì‹œ
            const targetScore = sortedPlayers[0].score;
            resultPlayers = sortedPlayers.filter(
              (p) => p.score === targetScore
            );

            // 2ëª… ì´ìƒì´ë©´ ê³µë™ ìš°ìŠ¹/ê¼´ë“± ë©”ì‹œì§€ ìˆ˜ì •
            if (resultPlayers.length > 1) {
              if (gameSettings.isWinnerMode) {
                resultMessage.textContent =
                  "ì¶•í•˜í•©ë‹ˆë‹¤! ë‹¤ìŒ í”Œë ˆì´ì–´ë“¤ì´ ê³µë™ ìš°ìŠ¹í–ˆìŠµë‹ˆë‹¤";
              } else {
                resultMessage.textContent =
                  "ì•„ì‰½ë„¤ìš”! ë‹¤ìŒ í”Œë ˆì´ì–´ë“¤ì´ ê³µë™ ê¼´ë“±ì…ë‹ˆë‹¤";
              }
            }
          }

          // ê²°ê³¼ ìºë¦­í„° ë Œë”ë§
          resultCharacters.innerHTML = "";
          resultPlayers.forEach((player) => {
            const characterItem = document.createElement("div");
            characterItem.className = `character-item ${
              gameSettings.isWinnerMode ? "winner" : "loser"
            }`;

            characterItem.innerHTML = `
              <div class="character-emoji highlight-pulse">${player.char}</div>
              <div class="character-info">
                <div class="character-name">${player.name}</div>
                <div class="character-score">${player.score}ì </div>
              </div>
            `;

            resultCharacters.appendChild(characterItem);
          });

          // 3. ì „ì²´ ì ìˆ˜ ìˆœìœ„í‘œ ë Œë”ë§
          scoreList.innerHTML = "";
          sortedPlayers.forEach((player, index) => {
            const scoreItem = document.createElement("div");

            // ê²°ê³¼ í”Œë ˆì´ì–´(ìŠ¹ì/íŒ¨ì) ê°•ì¡°
            const isResultPlayer = resultPlayers.some(
              (p) => p.id === player.id
            );
            scoreItem.className = `score-item ${
              isResultPlayer ? "highlighted" : ""
            }`;

            // ìˆœìœ„ í‘œì‹œ (ë™ì ìëŠ” ê°™ì€ ìˆœìœ„ ë¶€ì—¬)
            let rankText;

            // ìŠ¹ì/íŒ¨ì ê²°ì • ëª¨ë“œì— ë”°ë¼ ìˆœìœ„ í‘œì‹œ ë°©ì‹ ë³€ê²½
            if (gameSettings.isWinnerMode) {
              // ìŠ¹ì ê²°ì • ëª¨ë“œ - ì ìˆ˜ ë†’ì€ ìˆœì„œëŒ€ë¡œ 1ìœ„, 2ìœ„...
              if (
                index > 0 &&
                player.score === sortedPlayers[index - 1].score
              ) {
                // ì´ì „ í”Œë ˆì´ì–´ì™€ ì ìˆ˜ê°€ ê°™ìœ¼ë©´ ê°™ì€ ìˆœìœ„
                rankText = index + 1 - 1 + "ìœ„"; // ë™ì ìëŠ” ê°™ì€ ìˆœìœ„
              } else {
                rankText = index + 1 + "ìœ„";
              }
            } else {
              // íŒ¨ì ê²°ì • ëª¨ë“œ - ì ìˆ˜ ë‚®ì€ ìˆœì„œëŒ€ë¡œ ê¼´ë“±, 3ë“±, 2ë“±, 1ë“±...
              // ì •ë ¬ì€ ì´ë¯¸ ì˜¤ë¦„ì°¨ìˆœ(ë‚®ì€ ì ìˆ˜ ìˆœ)ìœ¼ë¡œ ë˜ì–´ ìˆìœ¼ë¯€ë¡œ
              // ì‹¤ì œ ìˆœìœ„ëŠ” ì „ì²´ í”Œë ˆì´ì–´ ìˆ˜ì—ì„œ í˜„ì¬ ì¸ë±ìŠ¤ë¥¼ ë¹¼ì„œ ê³„ì‚°
              const totalPlayers = players.length;
              const actualRank = totalPlayers - index;

              if (
                index > 0 &&
                player.score === sortedPlayers[index - 1].score
              ) {
                // ì´ì „ í”Œë ˆì´ì–´ì™€ ì ìˆ˜ê°€ ê°™ìœ¼ë©´ ê°™ì€ ìˆœìœ„
                const prevRank = totalPlayers - (index - 1);
                rankText = prevRank + "ìœ„";
              } else {
                rankText = actualRank + "ìœ„";
              }
            }

            scoreItem.innerHTML = `
              <div class="score-rank">${rankText}</div>
              <div class="score-player">
                <span class="score-emoji">${player.char}</span>
                <span class="score-name">${player.name}</span>
              </div>
              <div class="score-value">${player.score}ì </div>
            `;

            scoreList.appendChild(scoreItem);
          });

          // 4. ì‹œê°ì  íš¨ê³¼ ì¶”ê°€ (ìš°ìŠ¹ìê°€ ìˆëŠ” ê²½ìš°ë§Œ)
          if (gameSettings.isWinnerMode) {
            addConfettiEffect();
          }
        }

        // ìš°ìŠ¹ ì¶•í•˜ íš¨ê³¼ (ê°„ë‹¨í•œ ìƒ‰ì¢…ì´ íš¨ê³¼)
        function addConfettiEffect() {
          // ì‹¤ì œ ì•±ì—ì„œëŠ” lottie-react-native ê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© ê¶Œì¥
          const confetti = document.createElement("div");
          confetti.className = "confetti";

          // ê°„ë‹¨í•œ ìƒ‰ì¢…ì´ ëŒ€ì‹  ì´ëª¨ì§€ ì‚¬ìš©
          const emojis = ["ğŸ‰", "ğŸŠ", "âœ¨", "ğŸ¥³", "ğŸ¯", "ğŸ†"];
          let confettiHTML = "";

          for (let i = 0; i < 30; i++) {
            const randomEmoji =
              emojis[Math.floor(Math.random() * emojis.length)];
            const left = Math.random() * 100;
            const animationDelay = Math.random() * 5;

            confettiHTML += `
              <div class="animated-emoji" style="
                position: absolute; 
                left: ${left}%; 
                top: -20px; 
                animation-delay: ${animationDelay}s;
                font-size: ${Math.random() * 20 + 20}px;
              ">${randomEmoji}</div>
            `;
          }

          confetti.innerHTML = confettiHTML;
          document.getElementById("result-section").appendChild(confetti);
        }

        // ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        restartButton.addEventListener("click", () => {
          // ê²Œì„ ì¤€ë¹„ í™”ë©´ìœ¼ë¡œ ì´ë™
          alert("ê²Œì„ ì¤€ë¹„ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤");
          window.location.href = "game_preparation_screen.html";
        });

        // ì´ˆê¸°í™” - ê²°ê³¼ í‘œì‹œ
        displayResults();
      });
    </script>
  </body>
</html>
